<txp:php>
$file = 'https://raw.githubusercontent.com/textpattern/textpattern-curated-plugins-list/master/library-of-plugins/'.parse('<txp:title escape="json" />').'.json';

// if (is_readable($file)) {

$json = file_get_contents($file);
$json = json_decode($json);
$vars = array();

if (!empty($json->name)) {
    $vars['name'] = '<txp:variable name="json-name">'.txpspecialchars($json->name).'</txp:variable>';
}

if (!empty($json->repositories[0]->repoType)) {
    $vars['repotype'] = '<txp:variable name="json-repo-type">'.txpspecialchars($json->repositories[0]->repoType).'</txp:variable>';
}

if (!empty($json->repositories[0]->repoUrlStub)) {
    $vars['repostub'] = '<txp:variable name="json-repo-url-stub">'.txpspecialchars($json->repositories[0]->repoUrlStub).'</txp:variable>';
}

if (!empty($json->beta->version)) {
    $vars['beta-version'] = '<txp:variable name="json-beta-version">'.txpspecialchars($json->beta->version).'</txp:variable>';
}

if (!empty($json->stable->version)) {
    $vars['stable-version'] = '<txp:variable name="json-stable-version">'.txpspecialchars($json->stable->version).'</txp:variable>';
}

parse(implode(n, $vars));

// } // end of is_readable
</txp:php>

<!DOCTYPE html>
<html lang="en-GB-oxendict">
<head>
    <txp:output_form form="head" />
    <txp:if_article_list>
    <txp:else />
        <title>Plugin: <txp:title /> / Textpattern CMS plugin</title>
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "ItemPage",
                "headline": "Plugin: <txp:title escape="json" />",
                "description": "<txp:meta_description format="" escape="json" />",
                "url": "<txp:permlink escape="json" />",
                "potentialAction": {
                    "@type": "DownloadAction",
                    "object": {
                        "@type": "SoftwareApplication",
                        "name": "<txp:title escape="json" />",
                        "applicationCategory": "Plugin",
                        "softwareVersion": "<txp:variable name="json-stable-version" />",
                        "softwareRequirements": "Textpattern CMS",
                        "downloadUrl": ""
                    }
                }
            }
        </script>
    </txp:if_article_list>
    <txp:variable name="min-txp-version-unverified" value='<txp:category_list type="file" parent="txp-version" exclude="txp-version" limit="1"><txp:category title /></txp:category_list>' />
    <txp:variable name="max-txp-version-unverified" value='<txp:category_list type="file" parent="txp-version" exclude="txp-version" limit="1" sort="name desc"><txp:category title /></txp:category_list>' />
</head>
<body itemscope itemtype="https://schema.org/ItemPage">
    <txp:output_form form="body_header" />
    <main aria-label="Main content">
        <div class="container">
            <txp:output_form form="body_crumbs" />
            <txp:if_article_list>
                <h1 itemprop="name">Plugins list</h1>
                <txp:article form="article_listing" sort="Category2 desc, Title asc" limit="12" wraptag="div" class="layout-container" />
                <txp:output_form form="pagination" />
            <txp:else />
                <div class="layout-container">
                    <article class="layout-4col-3span" itemscope itemtype="https://schema.org/Article">
                        <meta itemprop="mainEntityOfPage" content="<txp:permlink />">
                        <h1 itemprop="headline">Plugin: <txp:title /></h1>
                        <p>
                            By
                            <span itemprop="author" itemscope itemtype="https://schema.org/Person">
                                <txp:article_custom section="authors" author-prefix='<txp:custom_field name="author-prefix" />' limit="1">
                                    <a class="article-author" rel="author" href="<txp:permlink />" itemprop="url"><span itemprop="name"><txp:title /></span></a>
                                </txp:article_custom>
                                <span>(plugin prefix <code itemprop="alternateName"><txp:custom_field name="author-prefix" /></code>)</span>
                            </span>
                        </p>
                        <div class="card-postinfo">
                            <span itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
                                <meta itemprop="name" content="Textpattern CMS">
                                <span itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
                                    <meta itemprop="url" content="https://textpattern.com/assets/img/branding/textpattern/textpattern.png">
                                    <meta itemprop="width" content="320">
                                    <meta itemprop="height" content="60">
                                </span>
                            </span>
                            <span class="separator--passive">Plugin categorization:</span>
                            <span itemprop="keywords">
                                <txp:category1 title link />
                            </span>
                            <br>
                            <span class="separator--passive">Textpattern version compatibility:</span>
                            <span class="inline-block">
                                <txp:if_custom_field name="min-txp-version">
                                    <span class="compatibility"><txp:custom_field name="min-txp-version" /></span>
                                <txp:else />
                                    <span class="compatibility"><txp:variable name="min-txp-version-unverified" /></span><b class="alert-block alert-pill warning">Unverified</b>
                                </txp:if_custom_field>
                                <txp:if_custom_field name="max-txp-version">
                                    <txp:if_custom_field name="min-txp-version" not value='<txp:custom_field name="max-txp-version" />'>
                                        <txp:if_custom_field name="max-txp-version" not value='<txp:variable name="min-txp-version-unverified" />'>
                                            <span role="separator" aria-label="To">→</span>
                                            <span class="compatibility"><txp:custom_field name="max-txp-version" /></span>
                                        </txp:if_custom_field>
                                    </txp:if_custom_field>
                                <txp:else />
                                    <txp:if_custom_field name="min-txp-version" not value='<txp:variable name="max-txp-version-unverified" />'>
                                        <span role="separator" aria-label="To">→</span>
                                        <span class="compatibility"><txp:variable name="max-txp-version-unverified" /></span><b class="alert-block alert-pill warning">Unverified</b>
                                    </txp:if_custom_field>
                                </txp:if_custom_field>
                            </span>
                        </div>
                        <txp:if_excerpt>
                            <div class="article-description" itemprop="description">
                                <h3>Description</h3>
                                <txp:excerpt />
                            </div>
                        </txp:if_excerpt>


<p>Test get name from JSON: <txp:variable name="json-name" /></p>
<p>Test get repo site from JSON: <txp:variable name="json-repo-type" /></p>
<txp:if_variable name="json-stable-version">
    <p>Test: stable <strong>does</strong> exist: <txp:variable name="json-stable-version" /></p>
<txp:else />
    <p>Test: stable <strong>does not</strong> exist</p>
</txp:if_variable>
<txp:if_variable name="json-beta-version">
    <p>Test: beta <strong>does</strong> exist: <txp:variable name="json-beta-version" /></p>
<txp:else />
    <p>Test: beta <strong>does not</strong> exist</p>
</txp:if_variable>
<txp:if_variable name="json-repo-type" value="github">
    <p>Test: is this on GitHub?: Yes</p>
<txp:else />
    <p>Test: is this on GitHub?: No</p>
</txp:if_variable>


                        </dl>
                        <p><img class="dark-contrast" width="200" height="200" alt="The Plugins Carver" src="/assets/img/plugins-carver.png" srcset="/assets/img/plugins-carver@2x.png 2x"></p>
                    </section>
                </div>
            </txp:if_article_list>
        </div>
    </main>
    <txp:output_form form="body_footer" />
</body>
</html>
