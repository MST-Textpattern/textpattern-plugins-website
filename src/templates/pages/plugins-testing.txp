<txp:evaluate query='"<txp:page_url type="3" />" = "json"'>
<txp:output_form form="json_card_reader" />
<txp:header value="application/json; charset=utf-8" />{
  "name": "<txp:title escape="json" />",
  "supersededBy": {
    "name": "shortcodes",
    "location": "https://docs.textpattern.com/tags/shortcodes/"
  },
<txp:if_variable name="json-latest-is-beta">
  "beta": {
    "version": "<txp:variable name="json-beta-version" />",
    "verifiedTxpCompatibility": "{ver-of-textpattern}",
    <txp:if_variable name="json-beta-date">"datePublished": "<txp:variable name="json-beta-date" />",</txp:if_variable>
    "endpointUrl": "{url-of-plugin-beta-endpoint}"
  },
</txp:if_variable>
  "stable": {
    "version": "<txp:if_variable name="json-stable-version"><txp:variable name="json-stable-version" /><txp:else /><txp:variable name="json-beta-version" /></txp:if_variable>",
    "verifiedTxpCompatibility": "{ver-of-textpattern}",
    <txp:if_variable name="json-stable-version"><txp:if_variable name="json-stable-date">"datePublished": "<txp:variable name="json-stable-date" />",</txp:if_variable><txp:else /><txp:if_variable name="json-beta-date">"datePublished": "<txp:variable name="json-beta-date" />",</txp:if_variable></txp:if_variable>
    "endpointUrl": "{url-of-plugin-stable-endpoint}"
  }
}
<txp:else />
<!DOCTYPE html>
<html lang="en-GB-oxendict">
<head>
    <txp:output_form form="head" />
    <txp:if_article_list>
    <txp:else />
        <txp:output_form form="json_card_reader" />
        <title>Plugin: <txp:title /> / Textpattern CMS plugin</title>
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "ItemPage",
                "headline": "Plugin: <txp:title escape="json" />",
                "description": "<txp:meta_description format="" escape="json" />",
                "url": "<txp:permlink escape="json" />"
                <txp:if_variable name="json-name">,
                    <txp:if_variable name="json-latest-is-beta">
                        "potentialAction": {
                            "@type": "DownloadAction",
                            "object": {
                                "@type": "SoftwareApplication",
                                "name": "<txp:title escape="json" />",
                                "applicationCategory": "Plugin",
                                "softwareRequirements": "Textpattern CMS",
                                "softwareVersion": "<txp:variable name="json-beta-version" />"
                                <txp:if_variable name="json-beta-date">, "datePublished": "<txp:variable name="json-beta-date" />"</txp:if_variable>
                                <txp:if_variable name="json-beta-php">, "downloadUrl": "<txp:variable name="json-beta-php" />"</txp:if_variable>
                                <txp:if_variable name="json-beta-txt">, "downloadUrl": "<txp:variable name="json-beta-txt" />"</txp:if_variable>
                            }
                        },
                    </txp:if_variable>
                    "potentialAction": {
                        "@type": "DownloadAction",
                        "object": {
                            "@type": "SoftwareApplication",
                            "name": "<txp:title escape="json" />",
                            "applicationCategory": "Plugin",
                            "softwareRequirements": "Textpattern CMS",
                            "softwareVersion": "<txp:if_variable name="json-stable-version"><txp:variable name="json-stable-version" /><txp:else /><txp:variable name="json-beta-version" /></txp:if_variable>"
                            <txp:if_variable name="json-stable-version"><txp:if_variable name="json-stable-date">, "datePublished": "<txp:variable name="json-stable-date" />"</txp:if_variable><txp:else /><txp:if_variable name="json-beta-date">, "datePublished": "<txp:variable name="json-beta-date" />"</txp:if_variable></txp:if_variable>
                            <txp:if_variable name="json-stable-version">
                                <txp:if_variable name="json-stable-php">, "downloadUrl": "<txp:variable name="json-stable-php" />"</txp:if_variable>
                                <txp:if_variable name="json-stable-txt">, "downloadUrl": "<txp:variable name="json-stable-txt" />"</txp:if_variable>
                            <txp:else />
                                <txp:if_variable name="json-beta-php">, "downloadUrl": "<txp:variable name="json-beta-php" />"</txp:if_variable>
                                <txp:if_variable name="json-beta-txt">, "downloadUrl": "<txp:variable name="json-beta-txt" />"</txp:if_variable>
                            </txp:if_variable>
                        }
                    }
                </txp:if_variable>
            }
        </script>
    </txp:if_article_list>
    <txp:variable name="min-txp-version-unverified" value='<txp:category_list type="file" parent="txp-version" exclude="txp-version" limit="1"><txp:category title /></txp:category_list>' />
    <txp:variable name="max-txp-version-unverified" value='<txp:category_list type="file" parent="txp-version" exclude="txp-version" limit="1" sort="name desc"><txp:category title /></txp:category_list>' />
</head>
<body itemscope itemtype="https://schema.org/ItemPage">
    <txp:output_form form="body_header" />
    <main aria-label="Main content">
        <div class="container">
            <txp:output_form form="body_crumbs" />
            <txp:if_article_list>
                <h1 itemprop="name">Plugins list</h1>
                <txp:article form="article_listing" sort="Category2 desc, Title asc" limit="12" wraptag="div" class="layout-container" />
                <txp:output_form form="pagination" />
            <txp:else />
                <div class="layout-container">
                    <article class="layout-4col-3span" itemscope itemtype="https://schema.org/Article">
                        <meta itemprop="mainEntityOfPage" content="<txp:permlink />">
                        <h1 itemprop="headline">Plugin: <txp:title /></h1>
                        <p>
                            By
                            <span itemprop="author" itemscope itemtype="https://schema.org/Person">
                                <txp:article_custom section="authors" author-prefix='<txp:custom_field name="author-prefix" />' limit="1">
                                    <a class="article-author" rel="author" href="<txp:permlink />" itemprop="url"><span itemprop="name"><txp:title /></span></a>
                                </txp:article_custom>
                                <span>(plugin prefix <code itemprop="alternateName"><txp:custom_field name="author-prefix" /></code>)</span>
                            </span>
                        </p>
                        <div class="card-postinfo">
                            <span itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
                                <meta itemprop="name" content="Textpattern CMS">
                                <span itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
                                    <meta itemprop="url" content="https://textpattern.com/assets/img/branding/textpattern/textpattern.png">
                                    <meta itemprop="width" content="320">
                                    <meta itemprop="height" content="60">
                                </span>
                            </span>
                            <span class="separator--passive">Plugin categorization:</span>
                            <span itemprop="keywords">
                                <txp:category1 title link />
                            </span>
                            <br>
                            <span class="separator--passive">Textpattern version compatibility:</span>
                            <span class="inline-block">
                                <txp:if_custom_field name="min-txp-version">
                                    <span class="compatibility"><txp:custom_field name="min-txp-version" /></span>
                                <txp:else />
                                    <span class="compatibility"><txp:variable name="min-txp-version-unverified" /></span><b class="alert-block alert-pill warning">Unverified</b>
                                </txp:if_custom_field>
                                <txp:if_custom_field name="max-txp-version">
                                    <txp:if_custom_field name="min-txp-version" not value='<txp:custom_field name="max-txp-version" />'>
                                        <txp:if_custom_field name="max-txp-version" not value='<txp:variable name="min-txp-version-unverified" />'>
                                            <span role="separator" aria-label="To">→</span>
                                            <span class="compatibility"><txp:custom_field name="max-txp-version" /></span>
                                        </txp:if_custom_field>
                                    </txp:if_custom_field>
                                <txp:else />
                                    <txp:if_custom_field name="min-txp-version" not value='<txp:variable name="max-txp-version-unverified" />'>
                                        <span role="separator" aria-label="To">→</span>
                                        <span class="compatibility"><txp:variable name="max-txp-version-unverified" /></span><b class="alert-block alert-pill warning">Unverified</b>
                                    </txp:if_custom_field>
                                </txp:if_custom_field>
                            </span>
                        </div>
                        <txp:if_excerpt>
                            <div class="article-description" itemprop="description">
                                <h3>Description</h3>
                                <txp:excerpt />
                                <p>TODO plugin homepage</p>
                            </div>
                        </txp:if_excerpt>
                        <txp:if_variable not name="json-name">
                            <p class="alert-block error">Plugin data not available.</p>
                        <txp:else />
                            <h3 id="releases">Download releases</h3>
                            <p>
                                Latest version is: <txp:variable name="json-latest" />
                                <txp:if_variable name="json-latest-is-beta"><br>Latest stable version is: <txp:variable name="json-stable-version" /></txp:if_variable>
                            </p>
                            <dl>
                                <txp:if_variable name="json-latest-is-beta">
                                    <dt><txp:variable name="json-name" /> <txp:variable name="json-beta-version" /> <small class="alert-block alert-pill warning">Prerelease</small></dt>
                                    <txp:if_variable name="json-beta-date">
                                        <dd>Release date: <time><txp:variable name="json-beta-date" /></time></dd>
                                    </txp:if_variable>
                                    <txp:if_variable name="json-beta-php">
                                        <dd><a href="<txp:variable name="json-beta-php" />">PHP download</a></dd>
                                    </txp:if_variable>
                                    <txp:if_variable name="json-beta-txt">
                                        <dd><a href="<txp:variable name="json-beta-txt" />">TXT download</a></dd>
                                    </txp:if_variable>
                                </txp:if_variable>
                                <txp:if_variable name="json-stable-version">
                                    <dt><txp:variable name="json-name" /> <txp:variable name="json-stable-version" /></dt>
                                    <txp:if_variable name="json-stable-date">
                                        <dd>Release date: <time><txp:variable name="json-stable-date" /></time></dd>
                                    </txp:if_variable>
                                    <txp:if_variable name="json-stable-php">
                                        <dd><a href="<txp:variable name="json-stable-php" />">PHP download</a></dd>
                                    </txp:if_variable>
                                    <txp:if_variable name="json-stable-txt">
                                        <dd><a href="<txp:variable name="json-stable-txt" />">TXT download</a></dd>
                                    </txp:if_variable>
                                <txp:else />
                                    <dt><txp:variable name="json-name" /> <txp:variable name="json-beta-version" /> <small class="alert-block alert-pill warning">Prerelease</small></dt>
                                    <txp:if_variable name="json-beta-date">
                                        <dd>Release date: <time><txp:variable name="json-beta-date" /></time></dd>
                                    </txp:if_variable>
                                    <txp:if_variable name="json-beta-php">
                                        <dd><a href="<txp:variable name="json-beta-php" />">PHP download</a></dd>
                                    </txp:if_variable>
                                    <txp:if_variable name="json-beta-txt">
                                        <dd><a href="<txp:variable name="json-beta-txt" />">TXT download</a></dd>
                                    </txp:if_variable>
                                </txp:if_variable>
                                <txp:php>
global $json;

if (!empty($json->legacy)) {
    foreach ($json->legacy as $avail) {
        foreach ($avail as $txpver => $legacy) {
            $safe_txpver = txpspecialchars($txpver);
            $safe_plugver = txpspecialchars($legacy->version);

            echo '<dt>'.txpspecialchars($json->name).' '.$safe_plugver.' <small class="alert-block alert-pill information">Legacy version for Textpattern '.$safe_txpver.'</small></dt>';

            if (!empty($legacy->date)) {
                echo '<dd>Release date: <time>'.txpspecialchars($legacy->date).'</time></dd>';
            }

            if (!empty($legacy->downloadUrlPhp)) {
                echo '<dd>'.href('PHP Download', txpspecialchars($legacy->downloadUrlPhp)).'</dd>';
            }

            if (!empty($legacy->downloadUrlTxt)) {
                echo '<dd>'.href('TXT Download', txpspecialchars($legacy->downloadUrlTxt)).'</dd>';
            }
        }
    }
}
                                </txp:php>
                            </dl>
                        </txp:if_variable>


<p>Test get repo site from JSON: <txp:variable name="json-repo-type" /></p>
<txp:if_variable name="json-repo-type" match="any" value="github">
    <p>Test: is this on GitHub?: Yes</p>
<txp:else />
    <p>Test: is this on GitHub?: No</p>
</txp:if_variable>
                        <p><img class="dark-contrast" width="200" height="200" alt="The Plugins Carver" src="/assets/img/plugins-carver.png" srcset="/assets/img/plugins-carver@2x.png 2x"></p>
                    </section>
                </div>
            </txp:if_article_list>
        </div>
    </main>
    <txp:output_form form="body_footer" />
</body>
</html>
</txp:evaluate>
