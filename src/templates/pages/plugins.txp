<!DOCTYPE html>
<html lang="en-GB-oxendict">
<head>
    <txp:output_form form="head" />
    <txp:if_category>
        <title>Category: <txp:category title /> / Textpattern CMS plugins</title>
        <meta name="description" content="Textpattern plugin ‘<txp:category title />’ category.">
        <meta name="robots" content="noindex, follow">
    <txp:else />
        <title>Textpattern CMS plugins | Plugins for the Textpattern content management system</title>
        <meta name="description" content="A curated collection of plugins, extensions, modifications and add-ons for Textpattern CMS.">
        <meta name="keywords" content="plugins, extensions, add-ons, modifications, cms, content management systems, open source, blogs, blogging, free, web design, web site design, web development, web site development, php, foss">
        <meta name="robots" content="index, follow">
        <link rel="canonical" href="<txp:site_url />">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@textpattern">
        <meta name="twitter:title" content="Textpattern CMS plugins | Plugins for the Textpattern content management system">
        <meta name="twitter:description" content="A curated collection of plugins, extensions, modifications and add-ons for Textpattern CMS.">
        <meta name="twitter:image:src" content="https://textpattern.com/apple-touch-icon-180x180.png">
        <meta name="twitter:url" content="<txp:site_url />">
        <meta property="og:site_name" content="Textpattern CMS">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Textpattern CMS plugins | Plugins for the Textpattern content management system">
        <meta property="og:description" content="A curated collection of plugins, extensions, modifications and add-ons for Textpattern CMS.">
        <meta property="og:image" content="https://textpattern.com/assets/img/branding/textpattern/textpattern-og.png">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="1200">
        <meta property="og:image:alt" content="Textpattern logo">
        <meta property="og:url" content="<txp:site_url />">
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "WebSite",
                "headline": "Textpattern CMS plugins | Plugins for the Textpattern content management system",
                "description": "A curated collection of plugins, extensions, modifications and add-ons for Textpattern CMS.",
                "url": "<txp:site_url escape="json" />"
            }
        </script>
    </txp:if_category>
</head>
<body itemscope itemtype="https://schema.org/WebPage">
    <txp:output_form form="body_header" />
    <main aria-label="Main content">
        <div class="container">

<txp:php>
function formatBytes($bytes, $precision = 2) {
    $units = array('B', 'KB', 'MB', 'GB', 'TB');

    $bytes = max($bytes, 0);
    $pow = floor(($bytes ? log($bytes) : 0) / log(1024));
    $pow = min($pow, count($units) - 1);

    $bytes /= pow(1024, $pow);

    return round($bytes, $precision) . ' ' . $units[$pow];
}

$github_key = parse('<txp:variable name="github-api-key" />');
$github_url = parse('<txp:custom_field name="github-repo" />');
$github_ident = explode('/', parse_url($github_url, PHP_URL_PATH));

$query = <<<'GRAPHQL'
query($organizationLogin:String!,$repositoryName:String!) {
  repository(owner:$organizationLogin, name:$repositoryName) {
    name
    url
    homepageUrl
    description
    stargazers {
      totalCount
    }
    releases(first: 10, orderBy: {field:CREATED_AT, direction:DESC}) {
      totalCount
      nodes {
        releaseAssets(last: 5) {
          nodes {
            createdAt
            name
            downloadCount
            createdAt
            downloadUrl
            size
            release {
              tagName
              name
              isPrerelease
              url
            }
          }
        }
      }
    }
    repositoryTopics(last: 10) {
      edges {
        node {
          url
          topic {
            name
          }
        }
      }
    }
    licenseInfo {
        name
        url
    }
    pushedAt
  }
}
GRAPHQL;
$variables = [
    'organizationLogin' => $github_ident[1],
    'repositoryName' => $github_ident[2]
];

$json = json_encode(['query' => $query, 'variables' => $variables]);
$curl = curl_init();

curl_setopt($curl, CURLOPT_URL, 'https://api.github.com/graphql');
curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($curl, CURLOPT_POSTFIELDS, $json);
curl_setopt($curl, CURLOPT_HTTPHEADER,
     array(
            'User-Agent: Textpattern CMS',
            'Content-Type: application/json;charset=utf-8',
            'Authorization: bearer '.$github_key
        )
    );

$response = curl_exec($curl);

if (curl_error($curl)) {
    // Do nothing.
} else {
    $data = json_decode($response);

    echo '<p>Plugin name: '.htmlspecialchars($data->data->repository->name).'</p>';
    echo '<p><a href="'.$data->data->repository->url.'">Plugin repo URL</a></p>';
    echo '<p>Stargazers: <a href="'.$data->data->repository->url.'/stargazers">'.$data->data->repository->stargazers->totalCount.'</a></p>';
    echo '<p>Total number of releases: <a href="'.$data->data->repository->url.'/releases">'.$data->data->repository->releases->totalCount.'</a></p>';
    echo '<p>License: <a href="'.$data->data->repository->licenseInfo->url.'">'.htmlspecialchars($data->data->repository->licenseInfo->tagName).'</a></p>';
    echo '<p>Latest activity: '.$data->data->repository->pushedAt.'</p>';
    echo '<h4>Releases</h4>';
    echo '<ol>';

    foreach ($data->data->repository->releases->nodes as $releaseElement) {
        echo '<li><a href="'.$releaseElement->releaseAssets->nodes[0]->release->url.'">'.htmlspecialchars($releaseElement->releaseAssets->nodes[0]->release->name).'</a>';
        echo '<ul>';

        foreach ($releaseElement->releaseAssets->nodes as $releaseSubElement) {
            echo '<li>'.htmlspecialchars($releaseSubElement->name).'</li>';
        }

        echo '</ul>';
        echo '</li>';
    }

    echo '</ol>';
}

curl_close($curl);

</txp:php>

        </div>
    </main>
    <txp:output_form form="body_footer" />
</body>
</html>
